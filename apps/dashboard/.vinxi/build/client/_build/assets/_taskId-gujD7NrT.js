import{H as C,E as D,z as E,r as m,j as e}from"./client-ZqeYz0xy.js";import{u as x}from"./useQuery-B_HBetP_.js";import{u as p}from"./useMutation-DPApNObB.js";const P=function(){const{taskId:i}=C.useParams(),g=D(),l=E(),[r,d]=m.useState(!1),[a,c]=m.useState(null),{data:s,isLoading:h}=x({queryKey:["task",i],queryFn:async()=>{const t=await fetch(`/api/tasks/${i}`);if(!t.ok)throw new Error("Failed to fetch task");return t.json()}}),{data:y,isLoading:j}=x({queryKey:["projects"],queryFn:async()=>{const t=await fetch("/api/projects");if(!t.ok)throw new Error("Failed to fetch projects");return t.json()}}),u=p({mutationFn:async t=>{const n=await fetch(`/api/tasks/${i}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const k=await n.json();throw new Error(k.error||"Failed to update task")}return n.json()},onSuccess:()=>{l.invalidateQueries({queryKey:["task",i]}),l.invalidateQueries({queryKey:["tasks"]}),d(!1)}}),b=p({mutationFn:async()=>{const t=await fetch(`/api/tasks/${i}`,{method:"DELETE"});if(!t.ok){const n=await t.json();throw new Error(n.error||"Failed to delete task")}return t.json()},onSuccess:()=>{l.invalidateQueries({queryKey:["tasks"]}),g({to:"/project-manager/inbox"})}});m.useEffect(()=>{s&&c(s)},[s]);const f=()=>{d(!0)},v=()=>{s&&c(s),d(!1)},N=()=>{a&&u.mutate(a)},w=()=>{window.confirm("Are you sure you want to delete this task?")&&b.mutate()},o=(t,n)=>{a&&c({...a,[t]:n})};return h||j?e.jsx("div",{className:"p-6",children:"Loading..."}):s?e.jsxs("div",{className:"p-6 max-w-3xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Task Details"}),e.jsx("div",{className:"flex gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:v,className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",disabled:u.isPending,children:u.isPending?"Saving...":"Save"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:f,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Edit"}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"Delete"})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),r?e.jsx("input",{type:"text",value:a?.title||"",onChange:t=>o("title",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}):e.jsx("p",{className:"text-lg",children:s.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),r?e.jsx("textarea",{value:a?.description||"",onChange:t=>o("description",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4}):e.jsx("p",{className:"text-gray-600",children:s.description||"No description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project"}),r?e.jsxs("select",{value:a?.projectId||"",onChange:t=>o("projectId",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"No Project"}),y?.projects.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}):e.jsx("p",{className:"text-gray-600",children:s.project?.name||"No project assigned"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),r?e.jsxs("select",{value:a?.priority||"medium",onChange:t=>o("priority",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]}):e.jsx("span",{className:`px-2 py-1 rounded-full text-sm ${s.priority==="low"?"bg-gray-200 text-gray-700":s.priority==="medium"?"bg-blue-200 text-blue-700":s.priority==="high"?"bg-orange-200 text-orange-700":"bg-red-200 text-red-700"}`,children:s.priority})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),r?e.jsx("input",{type:"date",value:a?.dueDate?.split("T")[0]||"",onChange:t=>o("dueDate",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}):e.jsx("p",{className:"text-gray-600",children:s.dueDate?new Date(s.dueDate).toLocaleDateString():"No due date"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),r?e.jsxs("select",{value:a?.status||"pending",onChange:t=>o("status",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]}):e.jsx("span",{className:`px-2 py-1 rounded-full text-sm ${s.status==="completed"?"bg-green-200 text-green-700":s.status==="in_progress"?"bg-yellow-200 text-yellow-700":"bg-gray-200 text-gray-700"}`,children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Created: ",new Date(s.createdAt).toLocaleString()]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Last updated: ",new Date(s.updatedAt).toLocaleString()]})]})]})]}):e.jsx("div",{className:"p-6",children:"Task not found"})};export{P as component};
