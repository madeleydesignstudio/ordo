import{AsyncLocalStorage as R}from"node:async_hooks";import{H3Event as m,getRequestWebStream as w,getRequestURL as U,eventHandler as j}from"h3";function v(e={}){let t,o=!1;const a=s=>{if(t&&t!==s)throw new Error("Context conflict")};let r;if(e.asyncContext){const s=e.AsyncLocalStorage||globalThis.AsyncLocalStorage;s?r=new s:console.warn("[unctx] `AsyncLocalStorage` is not provided.")}const n=()=>{if(r){const s=r.getStore();if(s!==void 0)return s}return t};return{use:()=>{const s=n();if(s===void 0)throw new Error("Context is not available");return s},tryUse:()=>n(),set:(s,i)=>{i||a(s),t=s,o=!0},unset:()=>{t=void 0,o=!1},call:(s,i)=>{a(s),t=s;try{return r?r.run(s,i):i()}finally{o||(t=void 0)}},async callAsync(s,i){t=s;const d=()=>{t=s},p=()=>t===s?d:void 0;g.add(p);try{const u=r?r.run(s,i):i();return o||(t=void 0),await u}finally{g.delete(p)}}}}function _(e={}){const t={};return{get(o,a={}){return t[o]||(t[o]=v({...e,...a})),t[o]}}}const c=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:typeof window<"u"?window:{},h="__unctx__",S=c[h]||(c[h]=_()),A=(e,t={})=>S.get(e,t),f="__unctx_async_handlers__",g=c[f]||(c[f]=new Set);function T(e){let t;const o=P(e),a={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(o,{...a,body:e.node.req.body}):new Request(o,{...a,get body(){return t||(t=E(e),t)}})}function k(e){return e.web??(e.web={request:T(e),url:P(e)}),e.web.request}function I(){return C()}const x=Symbol("$HTTPEvent");function $(e){return typeof e=="object"&&(e instanceof m||e?.[x]instanceof m||e?.__is_event__===!0)}function b(e){return function(...t){var o;const a=t[0];if($(a))t[0]=a instanceof m||a.__is_event__?a:a[x];else{if(!((o=globalThis.app.config.server.experimental)!=null&&o.asyncContext))throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");t.unshift(I())}return e(...t)}}const P=b(U),E=b(w);function H(){var e;return A("nitro-app",{asyncContext:!!((e=globalThis.app.config.server.experimental)!=null&&e.asyncContext),AsyncLocalStorage:R})}function C(){const e=H().use().event;if(!e)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");return e}const L=[{path:"/__root",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/__root.tsx"},{path:"/fitness-tracker",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/fitness-tracker.tsx"},{path:"/",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/index.tsx"},{path:"/journal",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/journal.tsx"},{path:"/settings",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/settings.tsx"},{path:"/signin",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/signin.tsx"},{path:"/api/projects",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/api/projects.ts",$APIRoute:{src:"app/routes/api/projects.ts?pick=APIRoute",build:()=>import("../projects.js"),import:()=>import("../projects.js")}},{path:"/api/tasks",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/api/tasks.ts",$APIRoute:{src:"app/routes/api/tasks.ts?pick=APIRoute",build:()=>import("../tasks.js"),import:()=>import("../tasks.js")}},{path:"/content-manager/bulk-unsubscribe",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/content-manager/bulk-unsubscribe.tsx"},{path:"/content-manager/companies",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/content-manager/companies.tsx"},{path:"/content-manager/email",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/content-manager/email.tsx"},{path:"/content-manager",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/content-manager/index.tsx"},{path:"/content-manager/opportunities",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/content-manager/opportunities.tsx"},{path:"/content-manager/people",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/content-manager/people.tsx"},{path:"/finance-manager",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/finance-manager/index.tsx"},{path:"/project-manager/:$projectSlug?",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/project-manager/$projectSlug.tsx"},{path:"/project-manager/canvas",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/project-manager/canvas.tsx"},{path:"/project-manager/inbox",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/project-manager/inbox.tsx"},{path:"/project-manager",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/project-manager/index.tsx"},{path:"/project-manager/my-issues",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/project-manager/my-issues.tsx"},{path:"/project-manager/notebooks",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/project-manager/notebooks.tsx"},{path:"/project-manager/notes",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/project-manager/notes.tsx"},{path:"/project-manager/projects",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/project-manager/projects.tsx"},{path:"/project-manager/tasks",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/project-manager/tasks.tsx"},{path:"/api/projects/:$projectSlug?",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/api/projects/$projectSlug.ts",$APIRoute:{src:"app/routes/api/projects/$projectSlug.ts?pick=APIRoute",build:()=>import("../_projectSlug.js"),import:()=>import("../_projectSlug.js")}},{path:"/api/tasks/:$taskId?",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/api/tasks/$taskId.ts",$APIRoute:{src:"app/routes/api/tasks/$taskId.ts?pick=APIRoute",build:()=>import("../_taskId.js"),import:()=>import("../_taskId.js")}},{path:"/project-manager/task/:$taskId?",filePath:"/Users/mxdeley/madeleydesignstudio/ordo/apps/dashboard/app/routes/project-manager/task/$taskId.tsx"}],q=["GET","POST","PUT","PATCH","DELETE","OPTIONS","HEAD"];function O(e){return j(async t=>{const o=k(t);return await e({request:o})})}const M=e=>t=>({path:e,methods:t});function W(e,t){const o=e.pathname.split("/").filter(Boolean),a=t.sort((r,n)=>{const s=r.routePath.split("/").filter(Boolean);return n.routePath.split("/").filter(Boolean).length-s.length}).filter(r=>{const n=r.routePath.split("/").filter(Boolean);return o.length>=n.length});for(const r of a){const n=r.routePath.split("/").filter(Boolean),s={};let i=!0;for(let d=0;d<n.length;d++){const p=n[d],u=o[d];if(p.startsWith("$"))if(p==="$"){const l=o.slice(d).join("/");if(l!=="")s["*"]=l,s._splat=l;else{i=!1;break}}else{const l=p.slice(1);s[l]=u}else if(p!==u){i=!1;break}}if(i)return{routePath:r.routePath,params:s,payload:r.payload}}}const y=L.filter(e=>e.$APIRoute);function B(e){const t=[];return e.forEach(o=>{const r=o.path.split("/").filter(Boolean).map(n=>n==="*splat"?"$":n.startsWith(":$")&&n.endsWith("?")?n.slice(1,-1):n).join("/");t.push({routePath:`/${r}`,payload:o})}),t}const D=async({request:e})=>{if(!y.length)return new Response("No routes found",{status:404});if(!q.includes(e.method))return new Response("Method not allowed",{status:405});const t=B(y),o=new URL(e.url,"http://localhost:3000"),a=W(o,t);if(!a)return new Response("Not found",{status:404});let r;try{r=await a.payload.$APIRoute.import().then(i=>i.APIRoute)}catch(i){return console.error("Error importing route file:",i),new Response("Internal server error",{status:500})}if(!r)return new Response("Internal server error",{status:500});const n=e.method,s=r.methods[n];return s?await s({request:e,params:a.params}):new Response("Method not allowed",{status:405})};export{M as a,O as c,D as d};
