import{drizzle as v}from"drizzle-orm/neon-http";import{neon as b}from"@neondatabase/serverless";import{config as E}from"dotenv";import{relations as f}from"drizzle-orm";import{pgEnum as c,pgTable as h,timestamp as a,text as m,varchar as _,serial as y,integer as C}from"drizzle-orm/pg-core";function w(e){if(Array.isArray(e))return e.flatMap(H=>w(H));if(typeof e!="string")return[];const r=[];let t=0,n,s,o,p,l;const i=()=>{for(;t<e.length&&/\s/.test(e.charAt(t));)t+=1;return t<e.length},g=()=>(s=e.charAt(t),s!=="="&&s!==";"&&s!==",");for(;t<e.length;){for(n=t,l=!1;i();)if(s=e.charAt(t),s===","){for(o=t,t+=1,i(),p=t;t<e.length&&g();)t+=1;t<e.length&&e.charAt(t)==="="?(l=!0,t=p,r.push(e.slice(n,o)),n=t):t=o+1}else t+=1;(!l||t>=e.length)&&r.push(e.slice(n,e.length))}return r}function D(e){return e instanceof Headers?new Headers(e):Array.isArray(e)?new Headers(e):typeof e=="object"?new Headers(e):new Headers}function I(...e){return e.reduce((r,t)=>{const n=D(t);for(const[s,o]of n.entries())s==="set-cookie"?w(o).forEach(l=>r.append("set-cookie",l)):r.set(s,o);return r},new Headers)}function F(e,r){return new Response(JSON.stringify(e),{...r,headers:I({"content-type":"application/json"},r?.headers)})}const j=c("project_status",["not_started","in_progress","on_hold","completed","cancelled"]),A=c("task_status",["todo","in_progress","in_review","done"]),N=c("priority",["low","medium","high","urgent"]),d=h("projects",{id:y("id").primaryKey(),name:_("name",{length:255}).notNull(),description:m("description"),status:j("status").default("not_started").notNull(),startDate:a("start_date").defaultNow(),dueDate:a("due_date"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()}),u=h("tasks",{id:y("id").primaryKey(),title:_("title",{length:255}).notNull(),description:m("description"),status:A("status").default("todo").notNull(),priority:N("priority").default("medium").notNull(),projectId:C("project_id").references(()=>d.id,{onDelete:"cascade"}),dueDate:a("due_date"),createdAt:a("created_at").defaultNow().notNull(),updatedAt:a("updated_at").defaultNow().notNull()}),R=f(d,({many:e})=>({tasks:e(u)})),x=f(u,({one:e})=>({project:e(d,{fields:[u.projectId],references:[d.id]})})),z=Object.freeze(Object.defineProperty({__proto__:null,priorityEnum:N,projectStatusEnum:j,projects:d,projectsRelations:R,taskStatusEnum:A,tasks:u,tasksRelations:x},Symbol.toStringTag,{value:"Module"}));E({path:".env"});const O=b(process.env.DATABASE_URL),J=v(O,{schema:z});export{J as d,F as j,d as p,u as t};
