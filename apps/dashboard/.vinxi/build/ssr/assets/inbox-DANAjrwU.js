import{jsx as t,jsxs as r}from"react/jsx-runtime";import{useQueryClient as T,useQuery as p,useMutation as S}from"@tanstack/react-query";import{useNavigate as D,Link as g}from"@tanstack/react-router";import{useState as h}from"react";const q=function(){const b=D(),[y,a]=h(!1),[i,o]=h({title:"",description:"",projectId:"",priority:"medium",dueDate:new Date().toISOString().split("T")[0]}),x=T(),{data:d,isLoading:f}=p({queryKey:["tasks"],queryFn:async()=>{const e=await fetch("/api/tasks");if(!e.ok)throw new Error("Failed to fetch tasks");return e.json()}}),{data:v,isLoading:N}=p({queryKey:["projects"],queryFn:async()=>{const e=await fetch("/api/projects");if(!e.ok)throw new Error("Failed to fetch projects");return e.json()}}),l=S({mutationFn:async e=>{const n=e.projectId||"1",s=await fetch(`/api/projects/${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e.title,description:e.description,priority:e.priority,dueDate:e.dueDate})});if(!s.ok){const C=await s.json();throw new Error(C.error||"Failed to create task")}return s.json()},onSuccess:()=>{x.invalidateQueries({queryKey:["tasks"]}),a(!1),o({title:"",description:"",projectId:"",priority:"medium",dueDate:new Date().toISOString().split("T")[0]})}}),j=e=>{e.preventDefault(),l.mutate(i)},c=e=>{b({to:"/project-manager/task/$taskId",params:{taskId:e}})},w=new Date().toISOString().split("T")[0],u=d?.tasks.filter(e=>e.dueDate?e.dueDate.split("T")[0]===w:!1)||[],m=d?.tasks.filter(e=>!e.dueDate)||[];return f||N?t("div",{className:"p-6",children:"Loading..."}):r("div",{className:"p-6",children:[r("div",{className:"flex justify-between items-center mb-6",children:[t("h1",{className:"text-2xl font-bold",children:"Inbox"}),t("button",{onClick:()=>a(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Create Task"})]}),r("div",{className:"mb-8",children:[t("h2",{className:"text-xl font-semibold mb-4",children:"Today's Tasks"}),u.length===0?t("div",{className:"text-gray-500 italic p-4 border rounded-lg",children:"No tasks due today."}):t("div",{className:"grid gap-4",children:u.map(e=>r("div",{onClick:()=>c(e.id),className:"p-4 border rounded-lg hover:bg-gray-50 transition-colors cursor-pointer group",children:[r("div",{className:"flex justify-between items-start",children:[r("div",{children:[t("h3",{className:"text-lg font-semibold group-hover:text-blue-600 transition-colors",children:e.title}),e.description&&t("p",{className:"text-gray-600 mt-1",children:e.description})]}),t("div",{className:"flex items-center gap-2",children:t("span",{className:`px-2 py-1 rounded-full text-xs ${e.priority==="low"?"bg-gray-200 text-gray-700":e.priority==="medium"?"bg-blue-200 text-blue-700":e.priority==="high"?"bg-orange-200 text-orange-700":"bg-red-200 text-red-700"}`,children:e.priority})})]}),t("div",{className:"mt-3 flex justify-between items-center text-sm text-gray-500",children:t("div",{children:e.project&&r(g,{to:"/project-manager/$projectSlug",params:{projectSlug:e.project.id.toString()},className:"text-blue-600 hover:underline",onClick:n=>n.stopPropagation(),children:["Project: ",e.project.name]})})})]},e.id))})]}),r("div",{children:[t("h2",{className:"text-xl font-semibold mb-4",children:"Inbox Tasks"}),m.length===0?t("div",{className:"text-gray-500 italic p-4 border rounded-lg",children:"No inbox tasks. Create a task without a due date to see it here."}):t("div",{className:"grid gap-4",children:m.map(e=>r("div",{onClick:()=>c(e.id),className:"p-4 border rounded-lg hover:bg-gray-50 transition-colors cursor-pointer group",children:[r("div",{className:"flex justify-between items-start",children:[r("div",{children:[t("h3",{className:"text-lg font-semibold group-hover:text-blue-600 transition-colors",children:e.title}),e.description&&t("p",{className:"text-gray-600 mt-1",children:e.description})]}),t("div",{className:"flex items-center gap-2",children:t("span",{className:`px-2 py-1 rounded-full text-xs ${e.priority==="low"?"bg-gray-200 text-gray-700":e.priority==="medium"?"bg-blue-200 text-blue-700":e.priority==="high"?"bg-orange-200 text-orange-700":"bg-red-200 text-red-700"}`,children:e.priority})})]}),t("div",{className:"mt-3 flex justify-between items-center text-sm text-gray-500",children:t("div",{children:e.project&&r(g,{to:"/project-manager/$projectSlug",params:{projectSlug:e.project.id.toString()},className:"text-blue-600 hover:underline",onClick:n=>n.stopPropagation(),children:["Project: ",e.project.name]})})})]},e.id))})]}),y&&t("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[t("h2",{className:"text-xl font-bold mb-4",children:"Create New Task"}),r("form",{onSubmit:j,children:[r("div",{className:"mb-4",children:[t("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Task Title"}),t("input",{type:"text",id:"title",value:i.title,onChange:e=>o({...i,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),r("div",{className:"mb-4",children:[t("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),t("textarea",{id:"description",value:i.description,onChange:e=>o({...i,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),r("div",{className:"mb-4",children:[t("label",{htmlFor:"project",className:"block text-sm font-medium text-gray-700 mb-1",children:"Project (Optional)"}),r("select",{id:"project",value:i.projectId,onChange:e=>o({...i,projectId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t("option",{value:"",children:"No Project"}),v?.projects.map(e=>t("option",{value:e.id,children:e.name},e.id))]})]}),r("div",{className:"mb-4",children:[t("label",{htmlFor:"priority",className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),r("select",{id:"priority",value:i.priority,onChange:e=>o({...i,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t("option",{value:"low",children:"Low"}),t("option",{value:"medium",children:"Medium"}),t("option",{value:"high",children:"High"}),t("option",{value:"urgent",children:"Urgent"})]})]}),r("div",{className:"mb-4",children:[t("label",{htmlFor:"dueDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date (Optional)"}),t("input",{type:"date",id:"dueDate",value:i.dueDate,onChange:e=>o({...i,dueDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r("div",{className:"flex justify-end gap-2",children:[t("button",{type:"button",onClick:()=>a(!1),className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition-colors",children:"Cancel"}),t("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",disabled:l.isPending,children:l.isPending?"Creating...":"Create"})]})]})]})})]})};export{q as component};
