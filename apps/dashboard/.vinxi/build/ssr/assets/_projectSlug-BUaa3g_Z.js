import{jsx as t,jsxs as r}from"react/jsx-runtime";import{useQueryClient as v,useQuery as C,useMutation as u}from"@tanstack/react-query";import{useNavigate as T}from"@tanstack/react-router";import{useState as p}from"react";import{R as E}from"./ssr-BLYWBu-d.js";import"class-variance-authority";import"lucide-react";import"clsx";import"tailwind-merge";import"@radix-ui/react-slot";import"@radix-ui/react-dialog";import"@radix-ui/react-tooltip";import"@radix-ui/react-accordion";import"@radix-ui/react-separator";import"@radix-ui/react-label";import"@radix-ui/react-select";import"cmdk";import"h3";import"node:async_hooks";import"node:stream";import"react-dom/server";import"node:stream/web";const Y=function(){const{projectSlug:s}=E.useParams(),h=T(),[f,a]=p(!1),[i,l]=p({title:"",description:""}),c=v(),{data:n,isLoading:b,isError:y,error:g}=C({queryKey:["project",s],queryFn:async()=>{const e=await fetch(`/api/projects/${s}`);if(!e.ok)throw new Error("Failed to fetch project");return e.json()}}),d=u({mutationFn:async e=>{const o=await fetch(`/api/projects/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok){const m=await o.json();throw new Error(m.error||"Failed to create task")}return o.json()},onSuccess:()=>{c.invalidateQueries({queryKey:["project",s]}),a(!1),l({title:"",description:""})}}),x=u({mutationFn:async e=>{const o=await fetch(`/api/projects/${s}?taskId=${e}`,{method:"DELETE"});if(!o.ok){const m=await o.json();throw new Error(m.error||"Failed to delete task")}return o.json()},onSuccess:()=>{c.invalidateQueries({queryKey:["project",s]})}}),w=u({mutationFn:async()=>{const e=await fetch(`/api/projects/${s}`,{method:"DELETE"});if(!e.ok){const o=await e.json();throw new Error(o.error||"Failed to delete project")}return e.json()},onSuccess:()=>{c.invalidateQueries({queryKey:["projects"]}),h({to:"/project-manager/projects"})}}),N=e=>{e.preventDefault(),d.mutate(i)},j=e=>{window.confirm("Are you sure you want to delete this task?")&&x.mutate(e)},k=()=>{window.confirm("Are you sure you want to delete this project? This will also delete all tasks associated with it.")&&w.mutate()};return b?t("div",{children:"Loading..."}):y?r("div",{children:["Error: ",g?.message]}):r("div",{className:"p-6",children:[r("div",{className:"flex justify-between items-center mb-4",children:[t("h1",{className:"text-2xl font-bold",children:n?.name}),t("button",{onClick:k,className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm",children:"Delete Project"})]}),t("p",{className:"mb-6",children:n?.description}),r("div",{className:"space-y-4",children:[r("div",{className:"flex justify-between items-center",children:[t("h2",{className:"text-xl font-semibold",children:"Tasks"}),t("button",{onClick:()=>a(!0),className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm",children:"Add Task"})]}),t("ul",{className:"space-y-2",children:n?.tasks.length===0?t("li",{className:"text-gray-500 italic",children:"No tasks yet. Create your first task!"}):n?.tasks.map(e=>r("li",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[r("div",{className:"flex items-center gap-2",children:[t("input",{type:"checkbox",checked:e.completed,readOnly:!0,className:"h-4 w-4"}),t("span",{className:e.completed?"line-through text-gray-500":"",children:e.title})]}),t("button",{onClick:()=>j(e.id),className:"text-red-500 hover:text-red-700 text-sm",children:"Delete"})]},e.id))})]}),f&&t("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[t("h2",{className:"text-xl font-bold mb-4",children:"Create New Task"}),r("form",{onSubmit:N,children:[r("div",{className:"mb-4",children:[t("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Task Title"}),t("input",{type:"text",id:"title",value:i.title,onChange:e=>l({...i,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),r("div",{className:"mb-4",children:[t("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),t("textarea",{id:"description",value:i.description,onChange:e=>l({...i,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),r("div",{className:"flex justify-end gap-2",children:[t("button",{type:"button",onClick:()=>a(!1),className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition-colors",children:"Cancel"}),t("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",disabled:d.isPending,children:d.isPending?"Creating...":"Create"})]})]})]})})]})};export{Y as component};
