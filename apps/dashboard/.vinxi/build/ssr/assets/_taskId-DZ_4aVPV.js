import{jsx as e,jsxs as o,Fragment as p}from"react/jsx-runtime";import{useQueryClient as E,useQuery as g,useMutation as h}from"@tanstack/react-query";import{useNavigate as S}from"@tanstack/react-router";import{useState as y,useEffect as L}from"react";import{a as T}from"./ssr-BLYWBu-d.js";import"class-variance-authority";import"lucide-react";import"clsx";import"tailwind-merge";import"@radix-ui/react-slot";import"@radix-ui/react-dialog";import"@radix-ui/react-tooltip";import"@radix-ui/react-accordion";import"@radix-ui/react-separator";import"@radix-ui/react-label";import"@radix-ui/react-select";import"cmdk";import"h3";import"node:async_hooks";import"node:stream";import"react-dom/server";import"node:stream/web";const ee=function(){const{taskId:l}=T.useParams(),b=S(),d=E(),[n,c]=y(!1),[a,u]=y(null),{data:r,isLoading:f}=g({queryKey:["task",l],queryFn:async()=>{const t=await fetch(`/api/tasks/${l}`);if(!t.ok)throw new Error("Failed to fetch task");return t.json()}}),{data:x,isLoading:v}=g({queryKey:["projects"],queryFn:async()=>{const t=await fetch("/api/projects");if(!t.ok)throw new Error("Failed to fetch projects");return t.json()}}),m=h({mutationFn:async t=>{const i=await fetch(`/api/tasks/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok){const D=await i.json();throw new Error(D.error||"Failed to update task")}return i.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["task",l]}),d.invalidateQueries({queryKey:["tasks"]}),c(!1)}}),N=h({mutationFn:async()=>{const t=await fetch(`/api/tasks/${l}`,{method:"DELETE"});if(!t.ok){const i=await t.json();throw new Error(i.error||"Failed to delete task")}return t.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["tasks"]}),b({to:"/project-manager/inbox"})}});L(()=>{r&&u(r)},[r]);const w=()=>{c(!0)},k=()=>{r&&u(r),c(!1)},j=()=>{a&&m.mutate(a)},C=()=>{window.confirm("Are you sure you want to delete this task?")&&N.mutate()},s=(t,i)=>{a&&u({...a,[t]:i})};return f||v?e("div",{className:"p-6",children:"Loading..."}):r?o("div",{className:"p-6 max-w-3xl mx-auto",children:[o("div",{className:"flex justify-between items-center mb-6",children:[e("h1",{className:"text-2xl font-bold",children:"Task Details"}),e("div",{className:"flex gap-2",children:n?o(p,{children:[e("button",{onClick:k,className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition-colors",children:"Cancel"}),e("button",{onClick:j,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",disabled:m.isPending,children:m.isPending?"Saving...":"Save"})]}):o(p,{children:[e("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Edit"}),e("button",{onClick:C,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"Delete"})]})})]}),o("div",{className:"space-y-6",children:[o("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),n?e("input",{type:"text",value:a?.title||"",onChange:t=>s("title",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}):e("p",{className:"text-lg",children:r.title})]}),o("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),n?e("textarea",{value:a?.description||"",onChange:t=>s("description",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4}):e("p",{className:"text-gray-600",children:r.description||"No description"})]}),o("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project"}),n?o("select",{value:a?.projectId||"",onChange:t=>s("projectId",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"",children:"No Project"}),x?.projects.map(t=>e("option",{value:t.id,children:t.name},t.id))]}):e("p",{className:"text-gray-600",children:r.project?.name||"No project assigned"})]}),o("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),n?o("select",{value:a?.priority||"medium",onChange:t=>s("priority",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"low",children:"Low"}),e("option",{value:"medium",children:"Medium"}),e("option",{value:"high",children:"High"}),e("option",{value:"urgent",children:"Urgent"})]}):e("span",{className:`px-2 py-1 rounded-full text-sm ${r.priority==="low"?"bg-gray-200 text-gray-700":r.priority==="medium"?"bg-blue-200 text-blue-700":r.priority==="high"?"bg-orange-200 text-orange-700":"bg-red-200 text-red-700"}`,children:r.priority})]}),o("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),n?e("input",{type:"date",value:a?.dueDate?.split("T")[0]||"",onChange:t=>s("dueDate",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}):e("p",{className:"text-gray-600",children:r.dueDate?new Date(r.dueDate).toLocaleDateString():"No due date"})]}),o("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),n?o("select",{value:a?.status||"pending",onChange:t=>s("status",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"pending",children:"Pending"}),e("option",{value:"in_progress",children:"In Progress"}),e("option",{value:"completed",children:"Completed"})]}):e("span",{className:`px-2 py-1 rounded-full text-sm ${r.status==="completed"?"bg-green-200 text-green-700":r.status==="in_progress"?"bg-yellow-200 text-yellow-700":"bg-gray-200 text-gray-700"}`,children:r.status.replace("_"," ")})]}),o("div",{className:"pt-4 border-t",children:[o("p",{className:"text-sm text-gray-500",children:["Created: ",new Date(r.createdAt).toLocaleString()]}),o("p",{className:"text-sm text-gray-500",children:["Last updated: ",new Date(r.updatedAt).toLocaleString()]})]})]})]}):e("div",{className:"p-6",children:"Task not found"})};export{ee as component};
